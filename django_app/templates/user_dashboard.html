{% extends "base.html" %}
{% load get_item format_hours %}

{% block content %}

<h2>Panel użytkownika</h2>

<form method="get">
    <label>Miesiąc: </label>
    <select name="month">
        {% for m in months %}
            <option value="{{ m.num }}" {% if m.num == month %}selected{% endif %}>
                {{ m.name }}
            </option>
        {% endfor %}
    </select>

    <label>Rok: </label>
    <select name="year">
        {% for y in years %}
            <option value="{{ y }}" {% if y == year %}selected{% endif %}>
                {{ y }}
            </option>
        {% endfor %}
    </select>

    <button type="submit">Pokaż</button>
</form>

<form method="post">
    {% csrf_token %}
    <table>
        <tr>
            <th>Dzień</th>
            <th>Dzień tygodnia</th>
            <th>Godziny</th>
            <th>Miejsce (Tag)</th>
        </tr>

        {% for item in days %}
            {% with entry=hours|get_item:item.day %}
            <tr class="
                {% if item.day == today_day %} today-row {% endif %}
                {% if entry and entry.tag and entry.tag.is_static %} static-tag-row {% endif %}
                {% if item.weekday in 'Sobota,Niedziela' %} weekend-row {% endif %}
            ">
                <td>{{ item.day }}</td>
                <td>{{ item.weekday }}</td>

                <td>
                    <input type="number"
                           name="{{ item.day }}"
                           step="0.5"
                           min="0"
                           max="16"
                           {% if entry %} value="{{ entry.hours|format_hours }}" {% endif %}
                           {% if entry and entry.tag and entry.tag.is_static %} disabled {% endif %}
                    >
                </td>

                <td>
                    <select name="tag_{{ item.day }}">
                        <option value="" {% if not entry or not entry.tag %}selected{% endif %}>—</option>
                        {% for t in tags %}
                            <option value="{{ t.id }}" {% if entry and entry.tag_id == t.id %}selected{% endif %}>
                                {{ t.name }}{% if t.is_static %} (stały){% endif %}
                            </option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            {% endwith %}
        {% endfor %}

        <tr>
            <td colspan="2" style="text-align:right; font-weight:bold;">Suma:</td>
            <td style="font-weight:bold;">{{ total_hours|format_hours }}</td>
            <td></td>
        </tr>
    </table>

    <br>
    <button type="submit">Zapisz</button>
</form>

{% endblock %}
