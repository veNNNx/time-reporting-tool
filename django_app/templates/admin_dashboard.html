{% extends "base.html" %}
{% load get_item format_hours %}

{% block content %}

<h2>Panel administratora</h2>

<form method="get">
    <label>Miesiąc: </label>
    <select name="month">
        {% for m in months %}
            <option value="{{ m.num }}" {% if m.num == month %}selected{% endif %}>
                {{ m.name }}
            </option>
        {% endfor %}
    </select>

    <label>Rok: </label>
    <select name="year">
        {% for y in years %}
            <option value="{{ y }}" {% if y == year %}selected{% endif %}>
                {{ y }}
            </option>
        {% endfor %}
    </select>

    <button type="submit">Pokaż</button>
</form>

<form method="post">
    {% csrf_token %}

    <table>
        <tr>
            <th>Dzień</th>
            {% for u in users %}
                <th>{{ u.username }}</th>
            {% endfor %}
        </tr>

        {% for item in days %}
        <tr class="{% if item.weekday in 'Sobota,Niedziela' %}weekend-row{% endif %}">
            <td>{{ item.day }}<br>{{ item.weekday }}</td>

            {% for u in users %}
                {% with entry=entries_dict|get_item:u.id|get_item:item.day %}
                <td class="
                {% if item.day == today_day %} today-row {% endif %}
                {% if entry and entry.tag and entry.tag.is_static %}static-tag-row{% endif %}
                ">
                    <div class="hours-tag-cell">
                        <input type="number"
                               name="{{ u.id }}_{{ item.day }}"
                               step="0.5"
                               min="0"
                               max="16"
                               {% if entry %} value="{{ entry.hours|format_hours }}" {% endif %}
                        >
                        <select name="tag_{{ u.id }}_{{ item.day }}">
                            <option value="" {% if not entry or not entry.tag %}selected{% endif %}>—</option>
                            {% for t in tags %}
                                <option value="{{ t.id }}" {% if entry and entry.tag and entry.tag.id == t.id %}selected{% endif %}>
                                    {{ t.name }}{% if t.is_static %} (stały){% endif %}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </td>
                {% endwith %}
            {% endfor %}
        </tr>
        {% endfor %}

        <tr>
    <td style="text-align:right; font-weight:bold;">Suma:</td>
    {% for u in users %}
        <td style="font-weight:bold;">
            {{ total_hours_dict|get_item:u.id|format_hours }}
        </td>
    {% endfor %}
</tr>


    </table>

    <br>
    <button type="submit">Zapisz wszystkie zmiany</button>
</form>

{% endblock %}
